\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{shapes,snakes}
\usepackage{mathtools}

\input{../Def/commonDef}
\input{../Def/tikzDef}
%--
%--------------------------------------------------------------------------------------------------------------------------------
%-----------------listing
%--------------------------------------------------------------------------------------------------------------------------------

%-----------
%comment first in handout mode, second in lecture mode
%------------
\newcommand\PresentationOnly[1]{#1}
\newcommand\HandoutOnly[1]{}

%-----------
%\newcommand\PresentationOnly[1]{}
%\newcommand\HandoutOnly[1]{#1}


\newcommand{\TerminaleRed}[1]{
\ensuremath{
{\mbox{\mO\lstinline@#1@\mC}}
}\xspace}


\newcommand{\constructor}{\NonTerminale{k}}



\newcommand{\mdfOO}{\Terminale{Open}}
\newcommand{\mdfO}{\Terminale{O}}
\newcommand{\mdfCC}{\Terminale{External Readonly}}
\newcommand{\mdfC}{\Terminale{E R}}
%\newcommand{\mdfCForNode}{\!\mdfE\!\mdfR\!\!\!}
\newcommand{\mdfCForNode}{\!\!\!\mdfER\!\!\!}
\newcommand{\mdfTT}{\Terminale{Temporary}}
\newcommand{\mdfT}{\Terminale{T}}
\newcommand{\mdfUU}{\Terminale{Unique}}
\newcommand{\mdfU}{\Terminale{U}}

\newcommand{\mdfSS}{\Terminale{Shared}}
\newcommand{\mdfS}{\Terminale{S}}

\newcommand{\promotionP}{\scalebox{0.65}{\Terminale{PTP}}}
\newcommand{\promotionB}{\scalebox{0.65}{\Terminale{BLTP}}}
\newcommand{\promotionT}{\scalebox{0.65}{\Terminale{TTP}}}
\newcommand{\promotion}{\scalebox{0.65}{\NonTerminale{TP}}}

\newcommand{\MdfInPromotions}[1]{\TerminaleRed{m}\langle#1\rangle}
\newcommand{\DepSequence}[1]{\oSquare#1\cSquare}

\newcommand{\mdfI}{\TerminaleRed{i}}
\newcommand{\mdfF}{\TerminaleRed{f}}
\newcommand{\mdfM}{\TerminaleRed{m}}
\newcommand{\mdfB}{\TerminaleRed{b}}
\newcommand{\mdfR}{\TerminaleRed{r}}
\newcommand{\mdfE}{\TerminaleRed{e}}
\newcommand{\mdfER}{\TerminaleRed{er}}


\newcommand{\mdfImmutable}{\mdfI{mmutable}\xspace}
\newcommand{\mdfFresh}{\mdfF{resh}\xspace}
\newcommand{\mdfMutable}{\mdfM{utable}\xspace}
\newcommand{\mdfExternalReadonly}{\mdfE{xternal} \mdfR{eadonly}\xspace}
\newcommand{\mdfBalloon}{\mdfB{alloon}\xspace}
\newcommand{\mdfReadonly}{\mdfR{eadonly}\xspace}
\newcommand{\mdfExternal}{\mdfE{xternal}\xspace}




%--------------------------------------------------------------------------------------------------------------------------------
%------------------decorative
%--------------------------------------------------------------------------------------------------------------------------------
%\providecommand{\url}[1]{{\texttt{#1}}}
%\newenvironment{auxUrl}{
%\catcode`_=\active
%\newcommand_[1]{\_#1}
%}{}
%\providecommand{\url}[1]{{\begin{auxUrl}\texttt{#1}{\end{auxUrl}}}


\newcommand{\HSep}{\hbox to \columnwidth{\bf\hrulefill}}
\newcommand{\HSepLong}{\hbox to \textwidth{\bf\hrulefill}}
\newcommand{\smallLineBreak}{\\[0.1em]}
\newcommand{\largeLineBreak}{\\[7ex]}
\newcommand{\modified}[1]{\textcolor{red}{#1}}
%\newcommand{\Space}{\hskip 0.7em}

\newcommand{\Compiled}[1]{\V{{#1}^{\!\textbf{\texttt{c}}}}}

\newcommand{\SyntaxFlow}[1]{\Aux{terminating}(#1)}
\newcommand{\GuessType}[2]{\Aux{guessType}_{#1}(#2)}

\newcommand{\Resolve}[2]{\Aux{resolve}_{#1}(#2)}


\newcommand{\myCal}[1]{
    {%
    \scalebox{0.7}[0.95]{%
      $\mathcal{#1}$%
    }%
    }%
}
\newcommand{\myCalBig}[1]{
    {%
    \scalebox{1.1}[1.1]{%
      $\mathcal{#1}$%
    }%
    }%
}

%--------------------------------------------------------------------------------------------------------------------------------
%------------------matematiche
%--------------------------------------------------------------------------------------------------------------------------------
\newcommand{\dom}{\Aux{dom}}
\newcommand{\Dom}[1]{\dom(#1)}
%\newcommand{\max}{\Aux{max}}
\newcommand{\Max}[1]{\Aux{max}(#1)}
\newcommand{\Min}[1]{\Aux{min}(#1)}
%\newcommand{\Subst}[1]   {\llbracket{#1}\rrbracket}
%\newcommand{\Subst}[1]   {[{#1}]}
\newcommand{\LenSeq}[1]{{\mid #1\mid}}

\newcommand{\Tuple}[1]    {\langle{#1}\rangle}
\newcommand{\Pair}[2]     {\Tuple{{#1},{#2}}}
\newcommand{\Triple}[3]     {\Tuple{{#1},{#2},{#3}}}
\newcommand{\FourTuple}[4]     {\Tuple{{#1},{#2},{#3},{#4}}}

\newcommand{\disjoint}{{\pitchfork}}
\newcommand{\Disjoint}[2]{{#1{\disjoint}#2}}
\newcommand{\Rog}[2]{\Aux{rog}(#1,#2)}
\newcommand{\WriteRog}[2]{\Aux{w-rog}(#1,#2)}
\newcommand{\ValidConfiguration}[2]{\Aux{valid-configuration}(#1,#2)}

\newcommand{\effect}{\V\Theta}


\newcommand{\InferType}[2]{\Aux{inferType}_{#1}(#2)}

\newcommand{\Invoke}[3]{\Aux{invoke}_{#1}(#2,#3)}

%--------------------------------------------------------------------------------------------------------------------------------
%------------------contestuali
%--------------------------------------------------------------------------------------------------------------------------------
\newcommand{\ctxB}{\V{\myCalBig{E}\!\myCalBig{B}}}
\newcommand{\CtxB}[1]{\ctxB[#1]}
\newcommand{\ctxFull}{\V{{{\ctx}}^{\ensuremath{\star}}}}
\newcommand{\CtxFull}[1]{\ctxFull[#1]}
\newcommand{\ctx}{\V{\myCalBig{E}}}
\newcommand{\ceCtx}{\V{\myCalBig{C}\!\myCalBig{E}}}
\newcommand{\ctxStar}{\V{{{\ctx}}^{\ensuremath{\star}}}}
\newcommand{\ctxC}{\V{{{\ctx}}^{\mathrm{c}}}}
\newcommand{\ctxF}{\V{{{\ceCtx}}^{\mathrm{f}}}}
\newcommand{\ctxBC}{\V{\myCalBig{B}}}
\newcommand{\ctxVal}{\V{{{\ctx}}^{\mathrm{r}}}}
%\newcommand{\Ctx}[1]{\ctx\llbracket#1\rrbracket}
\newcommand{\Ctx}[1]{\ctx[#1]}
%\newcommand{\CtxStar}[1]{\ctxStar\llbracket#1\rrbracket}
\newcommand{\CtxStar}[1]{\ctxStar[#1]}
%\newcommand{\CtxC}[1]{\ctxC\llbracket#1\rrbracket}
\newcommand{\CtxC}[1]{\ctxC[#1]}
%\newcommand{\CtxF}[1]{\ctxF\llbracket#1\rrbracket}
\newcommand{\CtxF}[1]{\ctxF[#1]}
%\newcommand{\CtxBC}[1]{\ctxBC\llbracket#1\rrbracket}
\newcommand{\CtxBC}[1]{\ctxBC[#1]}
%\newcommand{\CtxVal}[1]{\ctxVal\llbracket#1\rrbracket}
\newcommand{\CtxVal}[1]{\ctxVal[#1]}
%\newcommand{\CeCtx}[1]{\ceCtx\llbracket#1\rrbracket}
\newcommand{\CeCtx}[1]{\ceCtx[#1]}
\newcommand{\hole}{\square}
\newcommand{\ctxSV}{\myCalBig{S}^{\mathrm{r}}}

%--------------------------------------------------------------------------------------------------------------------------------
%------------------linguaggi
%--------------------------------------------------------------------------------------------------------------------------------

\newcommand{\p}{\V{\NonTerminale{p}}}

\newcommand{\Def}[1]{\Aux{def}(#1)}
\newcommand{\Type}[2]{\Aux{mtype}(#1,#2)}
%\newcommand{\AddApex}[2]{%
%  {#1^{%
%  {}_{{\!}^{%
%    \scalebox{0.75}{$\NonTerminale{#2}$}%
%    }}
%  }}}
\newcommand{\AddApex}[2]{
  {{#1}\vphantom{\_}^{#2\hspace{-0.15ex}}}
}
\newcommand{\pt}{\V{\AddApex\p{t}}}


\newcommand*{\TypeJ}[3]{%
#1%
\vdash%
#2\largeDots#3%
}

\newcommand*{\SubTypeJ}[3]{%
#1%
\vdash%
#2\leq#3%
}


\newcommand*{\GammaJ}[2]{%
\Greybox{#1%
%\,\,{\mid}{\!@\!}{\rangle}\,\,%
%\doteq
=
#2}%
}


\newcommand*{\NoTopFBox}[1]{%
  \mbox{\begin{tabular}{|c|}%
    \\[-1ex]%
    \mbox{#1}\\%
  \hline%
  \end{tabular}%
  }%
}

\newcommand*{\SigBox}[1]{%
%\ensuremath{\HSep\strongEndLine}%
\!\begin{array}{l}
\HSepLong\\[-0.85ex]
%\HSep\\[-0.85ex]
\NoTopFBox{%
  \MathArray{%
    #1\\[0.8ex]}%
  }%
\end{array}
\\[1ex]
}


%METAVARIABILI
\newcommand*{\receiver}{\NonTerminale{r}}
%\newcommand*{\C}{{\cal{C}}}
\newcommand*{\catch}{\V{\cal{K}}}
\newcommand*{\with}{\V{\cal{W}}}
\newcommand*{\catchKw}{{\Kw{catch}}}
%\newcommand*{\C}{\V{\NonTerminale{C}}}
\newcommand*{\CMany}{\Many{\C}}
\newcommand*{\onStart}{{\V{\AddApex\on{s}}}}
\newcommand*{\onWith}{{\V{\AddApex\on{w}}}}
\newcommand*{\I}{\V{\NonTerminale{I}}}
\newcommand*{\IMany}{\Many{\I}}
\providecommand\T{}
\renewcommand*{\T}{\V{\NonTerminale{T}}}
%\newcommand*{\T}{\cal{T}}
\newcommand*{\TMany}{\Many{\T}}
\newcommand*{\x}{\V{\NonTerminale{x}}}
\newcommand*{\y}{\V{\NonTerminale{y}}}
\newcommand*{\z}{\V{\NonTerminale{z}}}
\providecommand\f{}
\renewcommand*{\f}{\NonTerminale{f}}
\newcommand*{\oi}{\V{\ensuremath{\iota}}}
\newcommand*{\xMany}{\Many{\x}}
\newcommand*{\oiMany}{\Many\oi}
\newcommand*{\TxMany}{\Many{\T\, \x}}
%\newcommand*{\xe}{\NonTerminale{xe}}
\newcommand\X{\V{\cal{X}}}
\newcommand\Xt[4]{
  %\varOpt\, \TOpt\,\x\initSign\e
  \ft{#1}{#2}{#3} \initSign #4
}

\newcommand\Xv{\V{{\cal{X}\!\Aux{v}}}}
\newcommand\XvP{\V{\Xv^{\p}}}
%\NonTerminale{xe}}
%\NonTerminale{vd}}
\newcommand*{\es}{\Many\e}
%\newcommand*{\xeDep}{\NonTerminale{J}}
\newcommand*{\logicExpr}{\V{\NonTerminale{L}}}
\newcommand*{\depExpr}{\NonTerminale{dep}}
%\newcommand*{\atom}{\pi}
%\newcommand*{\atomT}{\pi\!{\raisebox{0.2em}{\scalebox{0.5}{\T}}}}
\newcommand*{\DepExpr}[2]{#1\,\Terminale{if}\,#2}

\newcommand*{\xv}{\V{\NonTerminale{xv}}}
\newcommand*{\xx}{\V{\NonTerminale{xx}}}
\newcommand*{\e}{\V{\NonTerminale{e}}}
\newcommand*{\eMany}{\Many{\e}}


\providecommand\m{}
\renewcommand*{\m}
{\V{\NonTerminale{m}}}
%{\!\V{\raisebox{-0.2ex}{\scalebox{0.35}{$\hole$}}\NonTerminale{m}}}

\newcommand*{\mh}{\V{\NonTerminale{mh}}}
\newcommand*{\mhT}{\V{\AddApex\mh{t}}}
\newcommand*{\mhTt}[5]{
  #1 \, \methodKw \, #4 \, \Mh{#2}{#3} \, \exceptionKw \, #5
}
\newcommand*{\mhS}{\V{\AddApex\mh{s}}}
\newcommand*{\mhSt}[2]{
  %\methodKw \Mc{\m}{\xs}
  WWWW\methodKw \Mh{#1}{#2}
}
\newcommand*{\md}{\NonTerminale{md}}
\newcommand*{\fd}{\NonTerminale{fd}}
\newcommand*{\mdMany}{\NonTerminale{mds}}
\newcommand*{\fdMany}{\NonTerminale{fds}}
\newcommand*{\classDec}{\NonTerminale{cd}}
\newcommand*{\interfaceDec}{\NonTerminale{id}}
\newcommand*{\classDecMany}{\Many{\classDec}}
\providecommand\val{}
\renewcommand*{\val}{\V{\NonTerminale{v}}}
\newcommand*{\Val}[1]{\V{\val^{#1}}}
\newcommand*{\redex}{\NonTerminale{r}}
\newcommand*{\valMany}{\Many{\val}}
\newcommand*{\mdf}{%
%  \scalebox{0.7}{%
%    \ensuremath{\mathcal{M}}%
%  }%
  \V\mu
}
\newcommand*{\apex}{
  {\scalebox{0.7}{%
    \ensuremath{\mathcal{S}}%
  }}
}
\newcommand*{\apexL}{
  {\scalebox{0.7}{%
    \ensuremath{\mathcal{L}}%
  }}
}
\newcommand*{\level}{\NonTerminale{j}}
\newcommand*{\native}{\NonTerminale{native}}
\newcommand*{\catchSet}{\NonTerminale{QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQCS}}
\newcommand*{\catchClauses}{\NonTerminale{CC}}
\newcommand*{\memory}{\mu}
%--------------------------------------------------------------------------------------------------------------------------------
%------------------keyword e simboli
%--------------------------------------------------------------------------------------------------------------------------------
\newcommand*{\largeDots}{:}
\newcommand*{\strictDots}{{:}}
\newcommand*{\class}{\Kw{class}}
\newcommand*{\interface}{\Kw{interface}}
\newcommand*{\this}{\Ident{this}}
\newcommand\isKw{\Kw{is}}
%\newcommand\startKw{\Kw{start}}
\newcommand*{\return}{\Kw{return}}
\newcommand*{\implements}{\Kw{implements}}
\newcommand*{\extends}{\Kw{extends}}
\newcommand*{\Abstract}{\Kw{abstract}}
\newcommand*{\semiColon}{\semicolon}
\newcommand*{\semicolon}{\Terminale{;}}

\newcommand*{\commaSign}{\Terminale{,}}
\ifdefined\comma\relax\else%
\newcommand\comma\commaSign
\fi%

\newcommand*{\oRound}{\Terminale{(}}
\newcommand*{\cRound}{\Terminale{)}}
\newcommand*{\oCurly}{\Terminale{\{}}
\newcommand*{\cCurly}{\Terminale{\}}}
\newcommand*{\oSquare}{\Terminale{[}}
\newcommand*{\cSquare}{\Terminale{]}}
\newcommand*{\oR}{\Terminale{(}}
\newcommand*{\cR}{\Terminale{)}}
\newcommand*{\oC}{\Terminale{\{}}
\newcommand*{\cC}{\Terminale{\}}}
\newcommand*{\oS}{\Terminale{[}}
\newcommand*{\cS}{\Terminale{]}}

\newcommand*{\singleDot}{{\Terminale{.}}}
\newcommand*{\classSep}{{\colon\colon}}
\newcommand\equalSign{\colon\initSign}
%\newcommand*{\staticMdf}{\ensuremath{{}^{*}}}
%\newcommand*{\preApex}
%  {\ensuremath{\raisebox{0.2em}{\mbox{\Q@'@}}}}
\newcommand{\postApex}
  {\Terminale{\ensuremath{\raisebox{0.2em}{\mbox{\Q@^@}}}}}
\newcommand{\preApex}{\postApex}

%\newcommand*{\mdfS}{\Terminale{S}}
\newcommand*{\mdfNotS}{\ensuremath{\epsilon}QQQQQQQQ}
%\newcommand*{\mdfM}{\Terminale{M}}
\newcommand*{\mdfNotM}{\ensuremath{\epsilon}QQQQQQQQQQ}
%\newcommand*{\mdfE}{\Terminale{E}QQQQQQQQQ}
\newcommand*{\mdfNotE}{\ensuremath{\epsilon}QQQQQQQQQQ}
\newcommand*{\isM}{\NonTerminale{M}QQQQQQQQ}

\newcommand*{\mdfAssignable}{QQQQQQQQQQQQQQQQQQQ}
\newcommand*{\mdfNotAssignable}{QQQQQQQQQQQQQQQ}
\newcommand*{\safeGuard}{\NonTerminale{G}}
\newcommand*{\xoi}{\NonTerminale{w}}
\newcommand*{\PostMdf}[1]{\ensuremath{\mbox{\Q@`@}{}^{#1}}}
\newcommand*{\PreMdf}[1]{\ensuremath{\mbox{\Q@'@}{}^{#1}}}
%ESPRESSIONI COMPOSTE
\newcommand*{\Fd}[2]{{#1}\,{#2}\semiColon}
\newcommand*{\Xe}[2]{#1\,\equalSign\,#2}
\newcommand*{\MethodCall}[3]{{#1}\singleDot{#2}\oRound{#3}\cRound}
\newcommand*{\FieldAccess}[2]{{#1}\singleDot{#2}}
\newcommand*{\FieldUpdate}[3]{{#1}\singleDot{#2}\equalSign{#3}}
\newcommand*{\NewCall}[2]{\kwNew\,#1\oRound#2\cRound}
\newcommand*{\Throw}[1]{\kwThrow\,#1}
\newcommand*{\Catch}[3]{\kwCatch\oRound#1\,#2\cRound\,#3}

%\newcommand*{\Mh}[3]{{{#1}\,{#2}\oRound{#3}\cRound}}
\newcommand*{\Mb}[1]{\oCurly\return\,{#1}\semiColon\cCurly}
\newcommand*{\ClassDec}[3]{\class\,#1\,\implements\,#2\,\oCurly #3 \cCurly}
\newcommand*{\InterfaceDec}[3]{\interface\,#1\,\extends\,#2\,\oCurly #3 \cCurly}
\newcommand*{\MultiLet}[2]{\oCurly#1\cCurly\,\kwIn\,#2}
%\newcommand*{\MultiLet}[2]{\oCurly#1\,#2\cCurly}
\newcommand*{\Get}[1]{\Terminale{get}\,#1}
\newcommand*{\Set}[1]{\Terminale{set}\,#1}
\newcommand{\fieldM}{\Kw{field}}
\newcommand{\abstractM}{\Kw{abstract}}
\newcommand*{\constructorM}{\Kw{constr}}
\newcommand*{\kwIn}{\Terminale{in}}
\newcommand*{\kwNew}{\Terminale{new}}
\newcommand*{\kwThrow}{\Terminale{throw}}
\newcommand*{\kwCatch}{\Terminale{catch}}

\newcommand{\TerminaleSp}[1]{%
\ensuremath{%
{\textup{\mbox{\lstinline[  identifierstyle=\relax,morekeywords=let]@#1@}}}%
}\xspace%
}
\newcommand*{\kwLet}{\TerminaleSp{let}}
\newcommand*{\PhVar}[1]{\preApex\!#1}

\newcommand*\bang{\Terminale{!}}

\newcommand*\hash{\scalebox{0.6}[0.6]{\Terminale{\!\#\!}}}

%%--------------------------------------------------------------------------------------------------------------------------------
%%------------------semantica
%%--------------------------------------------------------------------------------------------------------------------------------

\newcommand*{\runTimeEnv}{\Sigma}


%%--------------------------------------------------------------------------------------------------------------------------------
%%------------------frecce
%%--------------------------------------------------------------------------------------------------------------------------------

\newcommand*{\ReduceArrow}[1]{\UpDownArrow{}{#1}{\rightarrow}}
\newcommand*{\ReduceArrowPlus}[1]{\UpDownArrow{\littlePlus}{#1}{\rightarrow}}
\newcommand*{\ReduceArrowStar}[1]{\UpDownArrow{*}{#1}{\rightarrow}}
\newcommand*{\Reduce}[2]{#1{\ReduceArrow{}}#2}
\newcommand*{\ReduceStar}[2]{\GreyTallbox{#1{\ReduceArrowStar{}}#2}}
\newcommand*{\ReduceStarProgram}[3]{\GreyTallbox{#2{\ReduceArrowStar{#1}}#3}}
\newcommand*{\ReducePlus}[2]{\GreyTallbox{#1{\ReduceArrowPlus{}}#2}}


\newcommand\mts{\Many\mt}
\newcommand\ctFromClassB[1]{\ct^{#1}}
\newcommand\ctAddSubType[2]{#1[\outerKw\,#2]}

\newcommand{\setMinus}{\setminus}
\newcommand{\pathMinus}{{\smallsetminus}}

%%--------------------------------------------------------------------------------------------------------------------------------
%%------------------funzioni ausiliarie semantica
%%--------------------------------------------------------------------------------------------------------------------------------
\newcommand*{\FunctionFull}[1]{\Aux{objectTypes}(#1)}
\newcommand*{\FIOp}[1]{\Aux{fullyInit}(#1)}
\newcommand*{\PreOp}[1]{\Aux{ph}(#1)}
\newcommand*{\LockOp}[1]{\Aux{lock}(#1)}
\newcommand*{\UnlockOp}[1]{\Aux{unlock}(#1)}
\newcommand*{\Open}[2]{\Aux{open}(#1\mid#2)}
\newcommand*{\LClose}[1]{\Aux{l-close}(#1)}
\newcommand*{\ReadonlyOp}[1]{\Aux{to-readonly}(#1)}
\newcommand*{\LClosePTP}[1]{\Aux{l-close-p}(#1)}
\newcommand*{\LCloseTTP}[1]{\Aux{l-close-t}(#1)}
\newcommand*{\LCloseBLTP}[1]{\Aux{l-close-b}(#1)}
\newcommand*{\IsMutable}[1]{\Aux{isMutable}(#1)}

\newcommand*{\CaughtBy}[1]{\Aux{caught-by}(#1)}

%\newcommand*{\expressionPlaceholders}{\Aux{exprcommitted}}
\newcommand*{\ExpressionPlaceholders}[1]
{\Aux{var}({#1})}
\newcommand*{\isPartiallyInitializedFunction}{\Aux{notCommitted}}
\newcommand*{\IsPartiallyInitializedFunction}[2]{\isPartiallyInitializedFunction(#1,#2)}

\newcommand*{\Rph}[2]{\Aux{reachPh}(#1,#2)}
\newcommand*{\Oph}[2]{\Aux{oph}(#1,#2)}
\newcommand*{\DOpen}[1]{\Aux{openPh}(#1)}
\providecommand\ClassName{}
\renewcommand*{\ClassName}[2]{\Aux{cname}(#1,#2)}

\newcommand*{\FieldsFunction}[2]{\Aux{defFields}(#1,#2)}
\newcommand*{\fieldsFunction}{\Aux{defFields}}
\newcommand*{\CFieldsFunction}[1]{\EZ{defFields}(#1)}
\newcommand*{\NamesFunction}[2]{\Aux{names}({#1},{#2})}
\newcommand*{\CNamesFunction}[1]{\Aux{names}({#1})}
\newcommand*{\CDecsFunction}[1]{\Aux{decs}({#1})}
\newcommand*{\CDecFunction}[2]{\Aux{dec}({#1},{#2})}
\newcommand*{\DecFunction}[3]{\Aux{dec}({#1},{#2},{#3})}
\newcommand*{\DecTypeFunction}[3]{\Aux{decType}({#1},{#2},{#3})}
\newcommand*{\CDecTypeFunction}[2]{\Aux{decType}({#1},{#2})}

%\newcommand{\pending}{\Aux{pending}}
%\newcommand{\Pending}[1]{\pending(#1)}
\newcommand*{\InferDep}[3]{#1\bigcap_{#3}#2}
\newcommand*{\References}[1]{\Aux{ref}(#1)}
\newcommand*{\WriteReferences}[1]{\Aux{w-ref}(#1)}
\newcommand*{\EncapsulatedReferences}[1]{\Aux{e-ref}(#1)}
\newcommand*{\ExistsFunction}[2]{\Aux{exists}(#1,#2)}
\newcommand*{\Abs}[1]{\Aux{abs}(#1)}

\newcommand*{\Count}[1]{\Aux{count}(#1)}
\newcommand*{\ZeroSafe}[2]{{{}^#1}{/_{#2}}}
\newcommand{\Access}[2]{\Aux{f-access}_{#1}(#2)}
\newcommand{\Update}[2]{\Aux{f-update}_{#1}(#2)}
\newcommand{\Unrestricted}[1]{\Aux{unrestricted}(#1)}
\newcommand{\Affine}[1]{\Aux{affine}(#1)}
\newcommand{\AffineExternal}[1]{\Aux{affine-external}(#1)}

\newcommand\Using[3]{\usingKw\,#1\,\checkKw\,#2\,#3}

\newcommand*{\Mbody}[3]{\Aux{mBody}(#1,#2,#3)}

\newcommand*{\LogicDep}[4]{\Aux{dep}(#1,#2,#3,#4)}

\newcommand*{\MPFunction}[1]{\Aux{m-pred}(#1)}
\newcommand*{\BPFunction}[1]{\Aux{b-pred}(#1)}
\newcommand*{\DepFunction}[2]{\Aux{dep}(#1,#2)}
\newcommand*{\VarDepFunction}[2]{\Aux{v-dep}(#1,#2)}
\newcommand*{\ComputeDepFunction}[3]{\Aux{compute-dep}(#1,#2,#3)}
\newcommand*{\nonDisjoint}{{\,{\bigcap\!\!\!\!\!\bullet}\,\,}} 
\newcommand*{\dimFunction}{\Aux{dim}}
\newcommand{\DimFunction}[1]{\dim(#1)}


%%--------------------------------------------------------------------------------------------------------------------------------
%%------------------tipaggio
%%--------------------------------------------------------------------------------------------------------------------------------
\newcommand*{\phEnv}{\Gamma\preApex\!\!}
\newcommand*{\ct}{\V{\AddApex\classB{t}}}
\newcommand*{\ctMany}{\Many{\ct}}
%   kt, methods types
\newcommand*{\Ct}[3]{\oCurly #1 #2 #3 \cCurly}
%^{#4}}
\newcommand\labelVar{\V\lambda}
\newcommand\labelBot{\V\bot}
\newcommand\labelE{\raisebox{0.2ex}{\scriptsize{\textbf{E}}}}
\newcommand\labelNotE{\not\!\labelE}
\newcommand*{\mt}{\V{\AddApex\member{t}}}
\newcommand*{\kt}{\V{\NonTerminale{kt}}}
\newcommand*{\mtMany}{\Many{\mt}}

\newcommand*{\SubType}[2]{#1 {\leq} #2}
\newcommand*{\LevelOperator}[1]{
\raisebox{-0.2ex}{\ensuremath{
\begin{array}{c}
\raisebox{-0.5ex}{\scalebox{0.6}{$#1$}}
\\
\scalebox{2}{$\textasciitilde$}
\end{array}
}}
}
\newcommand*{\SubTypeLevel}[3]{
#2{\!\LevelOperator{#1}\!\!\!\!{\leq}\,} #3}

\newcommand*{\MethodType}[2]{#1{\rightarrow}#2}

\ifdefined\Case%
\renewcommand\Case[1]{\raisebox{0.15ex}{\scalebox{0.65}{\texttt{\textbf{\!\!\!\!\!(\!#1\!)}}}}}%
\else%
\newcommand\Case[1]{\raisebox{0.15ex}{\scalebox{0.65}{\texttt{\textbf{\!\!\!\!\!(\!#1\!)}}}}}%
\fi%

%funzioni ausiliarie type system
\newcommand*{\memberTypeFunction}{\Aux{mType}}
\newcommand*{\MemberTypeFunction}[3]{{\Aux{mType}}(#1,#2,#3)}
\newcommand*{\CMemberTypeFunction}[2]{{\Aux{mType}}(#1,#2)}
\newcommand*{\KTypeFunction}[2]{{\Aux{kType}}(#1,#2)}
\newcommand*{\kTypeFunction}{\Aux{kType}}


%solo in appendice
%\renewcommand\Box           {\,\raisebox{.57ex}{\fbox{\rule[0pt]{0pt}{0pt}}}\,}
\def\rbox                   {\nolinebreak~\hfill\Box}%fine dimostrazione
%cercare dove usato


%--------------------------------------------------------------------------------------------------------------------------------
%------------------Heap well formed
%--------------------------------------------------------------------------------------------------------------------------------


\newcommand*{\GarbageFunction}[3]{\Aux{gc}_{#1}^{#2}\!(#3)}
\newcommand*{\RBalloon}[2]{\Aux{RB}_{#1}\!(#2)}
\newcommand*{\RogFunction}[2]{\Aux{rog}_{#1}\!(#2)}
\newcommand*{\RogIFunction}[2]{\Aux{rog-ni}_{#1}\!(#2)}
\newcommand*{\ValidIFunction}[2]{\Aux{valid-i}_{#1}\!(#2)}
\newcommand*{\ValidBFunction}[3]{\Aux{valid-b}_{#1}^{#2}\!(#3)}
\newcommand*{\ValidFFunction}[3]{\Aux{valid-f}_{#1}^{#2}\!(#3)}
\newcommand*{\IHeap}[1]{\Aux{IH}_{#1}}
\newcommand*{\FHeap}[2]{\Aux{FH}_{#1}^{#2}}
\newcommand*{\THeap}[2]{\Aux{TH}_{#1}^{#2}}
\newcommand*{\SHeap}[2]{\Aux{SH}_{#1}^{#2}}

%\newcommand*{\FConvert}[2]{#1\,\Aux{f-convert}\,{#2}}
\newcommand*{\AssignableTo}[2]{#1\,\Aux{assignable-to}\,{#2}}

\newcommand*{\CheckI}[2]{\Aux{check-i}_{#1}^{#2}}
\newcommand*{\CheckS}[2]{\Aux{check-s}_{#1}^{#2}}
\newcommand*{\CheckB}[2]{\Aux{check-b}_{#1}^{#2}}

\newcommand*{\CheckITime}[4]{\Aux{check-i}_{#1}^{#2}\leadsto{}_{#3}^{#4}}
\newcommand*{\CheckSTime}[4]{\Aux{check-s}_{#1}^{#2}\leadsto{}_{#3}^{#4}}
\newcommand*{\CheckBTime}[4]{\Aux{check-b}_{#1}^{#2}\leadsto{}_{#3}^{#4}}

\newcommand*{\OtherBalloon}[3]{\Aux{OtherB}_{#1}^{#2}\!(#3)}
\newcommand*{\BCandidate}[2]{\Aux{BC}_{#1}^{#2}}
\newcommand*{\ICandidate}[2]{\Aux{IC}_{#1}^{#2}}
\newcommand*{\FCandidate}[2]{\Aux{FC}_{#1}^{#2}}
\newcommand*{\BCandidateStar}[2]{{\Aux{BC}_{#1}^{#2}}^*}

\newcommand*{\Link}[3]{{#2}\!\!\UpDownArrow{}{#1}{\xrightarrow{\hspace*{5ex}}}\!\!{#3}}
\newcommand*{\LinkE}[4]{{#3}\!\!\UpDownArrow{#1}{#2}{\xrightarrow{\hspace*{5ex}}}\!\!{#4}}
\newcommand*{\LinkL}[4]{{#3}\!\!\UpDownArrow{#1
%\scalebox{0.6}{${\leq}$}
}{#2}{\xrightarrow{\hspace*{5ex}}}\!\!{#4}}


\newcommand*{\MemoryWF}[2]{
\Greybox{#1%
\vdash%
#2}%
}

%--------------------------------------------------------------------------------------------------------------------------------
%------------------nomi
%--------------------------------------------------------------------------------------------------------------------------------
\newcommand*{\fjig}{\textsc{FJig}}
\newcommand*{\bij}{\ensuremath{\textsc{BI-Java}}\xspace}
\newcommand*{\mfjigAll}{\ensuremath{\textsc{MetaFJig}}\xspace}
%\newcommand*{\fjigFlat}{\ensuremath{{\fjig_0}}\xspace}
%\newcommand*{\fjigComp}{\ensuremath{{\fjig_1}}\xspace}
\newcommand{\dfjig}{\textsc{DeepFJig}}
%\newcommand*{\mfjig}{\ensuremath{\textsc{Meta}\fjigComp}\xspace}
%\newcommand*{\dmfjig}{\ensuremath{\textsc{Meta}\dfjig}\xspace}

\newcommand*{\phfj}{\textsc{FJ}\ensuremath{{}^{\mbox{\Q@^@\!}}}}

\newcommand{\InPageRule}[1]{%
  \begin{Scaled}{0.90}{0.90}%
  $\begin{array}{l}%
  \\[-0.5em]
  #1%
  \\[3em]
  \end{array}$%
  \end{Scaled}%
  }%


\newcommand{\ExampleAndComment}[4]{
  \begin{minipage}{0.25\linewidth}
  \end{minipage}
  \begin{Scaled}{0.85}{0.85}
  \begin{minipage}{0.85\linewidth}
  \end{minipage}
  \end{Scaled}
  }


\newcommand{\reductionSepare}{
${}_{}$\\ \noindent${}_{}$\\ \noindent}
\newcommand{\ReductionExample}[2]{
  {\relax\scalebox{0.8}{[#1]}}
  &
  {\begin{Scaled}{0.8}{0.8}$
    \begin{array}{c}
      \begin{array}[b]{l}\bO
      #2
      \end{array}\bC
    \end{array}
  $\end{Scaled}}
  &
  }



%-----------------------------------------------------
%-----------------------------------------------------
%------------new Macros for 42
%\newcommand\Opt[1]{\underline{#1}}
%\newcommand\Opt[1]{%
%\scalebox{0.7}[1.12]{%
%$[$%
%}#1%
%\scalebox{0.7}[1.12]{%
%$]$%
%}}

%\newcommand\Opt[1]{%
%\,\raisebox{1.1em}{\rotatebox{270}{%
%\ensuremath{%
%\left[\!\rotatebox{90}{\!\!\!\ensuremath{#1\,}}\right.%
%}}}}%

%\newcommand\Opt[1]{
%\,{\vphantom{#1}}^{\ulcorner}\!{{#1}}\!{\vphantom{#1}}^{\urcorner}\,\!\!}

\newcommand\Opt[1]{\V{{%
  \hspace{0.03ex}
  \overbracket[0.10ex][0.3ex]{\hspace{-0.03ex}#1\hspace{-0.03ex}}}}%
\hspace{0.03ex}
}

\newcommand\resource{\V{\NonTerminale{r}}}
\newcommand\plugin{\V{\NonTerminale{plg}}}
\newcommand\PlGet[1]{\Aux{plugin}(#1)}
\newcommand\PlRequire[1]{\Aux{require}(#1)}
\newcommand\PlSync[1]{\Aux{sync}(#1)}
\newcommand\PlRestrict[1]{\Aux{restrict}(#1)}
\newcommand\PlExecute[1]{\Aux{execute}(#1)}
\newcommand\GetValue[2]{\Aux{getValue}_{#1}(#2)}

\newcommand\Coherent[2]{\Aux{coherent}_{#1}(#2)}
\newcommand\AbstractClass[2]{\Aux{abstract}_{#1}(#2)}
\newcommand\StageOf[2]{\Aux{stageOf}_{#1}(#2)}
\newcommand\SuperOf[2]{\Aux{superOf}_{#1}(#2)}

\newlength\stageHeight
\newlength\stageWidth
\newcommand\ResizeTo[2]{{%
  \begingroup%
  \setlength{\mathsurround}{0pt}%
  \settowidth\stageWidth{#1}%
  \settoheight\stageHeight{#1}%
  \resizebox{\stageWidth}{\stageHeight}{#2}%
  \endgroup%
}}

\newcommand\TypeRS[1]{\ResizeTo{$\typeMeta$}{\ensuremath{#1}}}
\newcommand\typeLess{\TypeRS{\ominus}}
\newcommand\typePlus{\TypeRS{\oplus}}
\newcommand\typeStar{\TypeRS{\circledast}}
\newcommand\typeMeta{\circledcirc}
%\newcommand\typeMeta{{\scalebox{0.8}{\Inverse{\textbf{\texttt{M}}}}}}
\newcommand\typeLabel{\V\circledcirc}
%\newcommand\pt{pt}

\newcommand\EndIteration[2]{\Aux{endIteration}_{#1}(#2)}
\newcommand\Path{\V\pi}
%\newcommand\classB{\NonTerminale{cb}}
\newcommand\classB{\V{\cal{L}}}
\newcommand\multiT{\V{\cal{T}}}
\renewcommand\L{\V{\NonTerminale{s}}}
\newcommand\loopKw{\Kw{loop}}
\newcommand\on{\V{\cal{O}}}
\newcommand\ons{\Many\on}
\newcommand\onKw{\Kw{on}}
\newcommand\doKw{\Kw{do}}
\newcommand\varKw{\Kw{var}}
\newcommand{\initSign}{\raisebox{-0.08ex}{\scalebox{0.5}[1]{\Terminale{=}}}}
\newcommand{\equals}{\Terminale{$\customColon{2}$}}
\renewcommand{\equals}{\Terminale{$=$}}
\newcommand{\SymEquals}[1]{\Terminale{#1}\ensuremath{\initSign}}
\newcommand\implSign{\Terminale{<}\colon}
\newcommand\exceptionKw{\Kw{exception}}
\newcommand\errorKw{\Kw{error}}
\newcommand\returnKw{\Kw{return}}
\newcommand\h{\V{\cal{H}}}
\newcommand\member{\V{\cal{M}}}
\newcommand\members{\Many\member}
\newcommand\mhs{\Many\mh}
\newcommand\Outer{\Kw{Outer}}
\newcommand\This{\Terminale{This}}
\newcommand\mH{\mh}
\newcommand\interfaceKw{\Kw{interface}}
\newcommand\reuseKw{\Kw{reuse}}
\newcommand\methodKw{\Kw{method}}
\newcommand\setKw{\Terminale{set}}
\newcommand\getKw{\Terminale{get}}
\newcommand\exposeKw{\Terminale{expose}}
\newcommand\AnyKw{\Kw{Any}}
\newcommand\LibraryKw{\Kw{Library}}
\newcommand\VoidKw{\Kw{Void}}
\newcommand\voidKw{\Kw{void}}
\newcommand\docs{\V{\NonTerminale{d}\!\NonTerminale{o}\!\NonTerminale{c}}}
%\newcommand\vs{\NonTerminale{vs}}
\newcommand\vs{\Many\Xv}


\newlength\colonwidth
\newlength\colonheight

\newcommand{\customColon}[1]{%
  \begingroup
    \def\ms{0.35} % dimensions of square as ratio of total width of $:$
    \setlength{\mathsurround}{0pt}%
    \settowidth{\colonwidth}{$:$}%
    \settoheight{\colonheight}{$:$}%
    \begin{tikzpicture}[x=\colonwidth,y=\colonheight]
    
    % dummy border, so it's at least as big as the colon
    \draw[draw=none] (0, 0) rectangle +($(\colonwidth+#1*\ms\colonwidth, \colonheight)$);

    \fill ($(0.5\colonwidth-0.5*\ms\colonwidth, 0)$) rectangle +($(\ms\colonwidth+#1*\ms\colonwidth, \ms\colonheight)$);
    \fill ($(0.5\colonwidth-0.5*\ms\colonwidth, \colonheight-\ms\colonwidth)$) rectangle +($(\ms\colonwidth+#1*\ms\colonwidth, \ms\colonheight)$);


    \end{tikzpicture}%
  \endgroup
}

\renewcommand{\colon}{\Terminale{$\customColon{0}$}}
\renewcommand{\colon}{\Terminale{$:$}}


\newcommand\varEnv{\V\Gamma}
\newcommand\typeEnv{\V\Delta}
%\newcommand\sigEnv {\Theta}
\newcommand\sugarEnv{\Theta}
\newcommand\runEnv{\V\sigma}

\newcommand\varEnvCtx[1]{{\mbox{env}({#1})}}

\newcommand\scaleKw{0.53}
\newcommand\Kw[1]{\scalebox{\scaleKw}[1]{\Terminale{#1}}}
\newcommand\Ident[1]{\scalebox{\scaleKw}[1]{\def\textbf{} \Terminale{#1}}} % hacks
\newcommand\TMdf {\Kw{type}}
\newcommand\SMdf {\Kw{mut}}
\newcommand\RMdf {\Kw{read}}
\newcommand\OMdf {\Kw{owned}}
\newcommand\LMdf {\Kw{lent}}
\newcommand\CMdf {\Kw{capsule}}
\newcommand\IMdf {\Kw{immutable}}
\newcommand\botMdf {\AddApex\mdf\bot}

\newcommand\TypeJoin[2]{{#1}\Diamond{#2}}

\newcommand\mapUpdateSign{\,{:}{\raisebox{-0.08ex}{\scalebox{0.5}[1]{=}}}\,}
\newcommand\Subst[2]{[#1\mapUpdateSign#2]}

\newcommand\Vd[3]{\oRound#1 #2 #3\cRound}

\newcommand\TypeOf[2]{\Aux{classOf}_{#1}(#2)}
\newcommand\ExtractMBody[2]{\Aux{extractMBody}_{#1}(#2)}

\newcommand\OriginalMeth[2]{\Aux{originalMeth}_{#1}(#2)}


\newcommand\CapturableBy[4]{\Aux{captured}_{#1,#2}(#3,#4)}

\newcommand\CFType[1]{\Aux{c-f-type}(#1)}
\newcommand\FType[1]{\Aux{f-type}(#1)}
\newcommand\ExtractMType[2]
{\Aux{extractMType}_{#1}(#2)}
\newcommand\ExtractP[2]
{\Aux{extractP}(#1,#2)}
\newcommand*\ExtractMTypes\ExtractMType

\newcommand\AddVar[2]{[
\raisebox{0.15ex}{\scalebox{0.7}[0.7]{\textbf{+}}}\scalebox{0.5}[1]{$=$}
\,#1\mapUpdateSign#2]}
\newcommand\PushTo[2]{[#1\nwarrow#2]}



\newcommand\IsSet[3]{
\Nv\p(#1)=
\oCurly\Mh{\_}{\_\comma
\varKw\ \T #2 \oCurly \setKw #3\semiColon
\getKw\_\semiColon \Opt{\exposeKw\_\semiColon}
\cCurly\_}\_\cCurly
}
\newcommand\IsGet[3]{
\Nv\p(#1)=\oCurly\Mh{\_}{\_\comma
\Opt\varKw\ \T #2 \oCurly \Opt{\setKw\_\semiColon}
\getKw #3\semiColon \Opt{\exposeKw\_\semiColon}
\cCurly\_}\_\cCurly
}
\newcommand\IsExpose[3]{
\Nv\p(#1)=
\oCurly-{\_}{\_\comma
\Opt\varKw\ \T #2 \oCurly \Opt{\setKw\_\semiColon}
\getKw\_\semiColon \exposeKw#3\semiColon
\cCurly\_}\_\cCurly
}


%-----------End

%------------------------Start commands for 42 specific

\renewcommand\ldots{\scalebox{0.75}{$...$}}
\edef\myMapsto{\mapsto}
\renewcommand\mapsto{\scalebox{0.75}[1.2]{$\myMapsto\,$}}
\newcommand\privateKw{\Terminale{private}}
\newcommand\compilationError{\Terminale{error}}
\newcommand\EUP[1]{\Aux{extern}(#1)}
\newcommand\IC[2]{\Aux{internalOk}(#1,#2)}
\newcommand\IsWrong[2]{#1\,\Aux{is wrong in}\, #2}
\newcommand\Compilable[1]{\Aux{judgeReady}(#1)}
\newcommand\mPlus{\ensuremath{\,[\!+\!]\,}}
\newcommand\mPlusDisj{\ensuremath{\,[\!+\!_{\scalebox{0.6}{$\Aux{disj}$}}]\,}}
\newcommand\From[1]{[\Aux{from}\,#1]}
\newcommand\NotEx[1]{\Aux{non-exec}(#1)}
\newcommand\PopLast[1]{\Aux{pop-last}(#1)}
\newcommand\Defined[1]{\Aux{defined}(#1)}
\newcommand\DefinedArrow[1]{\Aux{defined}\dArrow(#1)}
\newcommand\dArrow{%
{}^{\scalebox{0.7}[0.5]{$\!\downarrow$}}\!
%\raisebox{0.3ex}{\scalebox{0.5}{$\downarrow$}}
}

\newcommand{\CounterSlant}[1]{\tikz[baseline=(X.base)] \node[xslant=-0.38] (X) {#1};}
\newcommand\oSquareSl{\CounterSlant{[}}
\newcommand\cSquareSl{\CounterSlant{]}}


\newcommand\walkBy{\raisebox{0.3ex}{\scalebox{0.6}{$\updownarrow$}}}

\newcommand\FilterFun[2]{
#2\!\raisebox{0.7ex}[1.4ex]{\scalebox{0.85}{\ensuremath{%
\!\!\!\oSquareSl\!\!\!\!#1\!\!\!\!\cSquareSl\!\!%
}}}%
}
%\newcommand\Mc[2]{\singleDot#1\!\oRound#2\cRound}
\newcommand\Mh[2]{#1\!\oRound#2\cRound}
\newcommand\xVar{\x^{\!\scalebox{0.5}{\varKw}}}
\newcommand\Cb[1]{\oCurly#1\cCurly}

%\renewcommand\Path{
%\textcolor{red}{\!QQ\!}
%}
\newcommand\Paths {\Many\Path}

\newcommand\cLdots{\comma\ldots\comma}

\newcommand\inside{\ \Aux{inside}\ }
\newcommand\inLeftOf{\ \Aux{in-left-of}\ }
\newcommand\ObjT[3]{
\Aux{obj}^{#1}_{#2}(#3)
}
\newcommand\SubReq[3]{
{\Aux{cost-of}_{#1}}({#2}\leq{#3}) 
}

\newcommand\ToPh[1]{\Aux{toPh}(#1)}
\providecommand\hv{}
\renewcommand\hv{{\h\dArrow}}
\newcommand\never{\bot}
\newcommand\TN{\Nv\T^\never}
\newcommand\typeAny[2]{\Aux{typeAny}(#1,#2)}

\newcommand\Norm[2]{\Aux{norm}_{#1}(#2)}
\newcommand\Super[2]{\Aux{super}_{#1}(#2)}
\newcommand\MHof[2]{\Aux{methodTypes}_{#1}(#2)}
\newcommand\Src[3]{\Aux{src}_{#1}(#2,#3)}
\newcommand\SingleDecl[2]{\Aux{singledecl}_{#1}(#2)}

\newcommand\mdfs{\Many\mdf}
\newcommand\allMdf{\#}
%\newcommand\Complete[1]{\Aux{complete}(#1)}
\newcommand\IsComplete[2]{\Aux{complete}_{#1}(#2)}

\newcommand\UpUp[2]{
\overset{
  \raisebox{0.65ex}{
  \scalebox{0.65}{\ensuremath{#1}}
  }}{
  \raisebox{-1.3ex}{  
  \scalebox{0.65}{\ensuremath{#2}}
  }}
}
\newcommand\arrowDash{
  \,\,\,\,%
  \scalebox{0.6}{\ensuremath{\downarrow}}%
  \!\!\!\!\!%
  \bigMid\!\!\raisebox{-0.8ex}{\scalebox{1.6}{%
    \ensuremath{\vdash}}%
    }%
  }
\newcommand\bigMid{%
  \raisebox{-0.5ex}{\scalebox{1.6}{\ensuremath\mid}}%
  }

\newcommand*{\TsJ}[3]{%
#1%
\vdash%
#2\largeDots#3%
}

\newcommand*{\SubT}[4]{%
#1%
\vdash^{#2}%
#3\leq#4%
}
\newcommand*{\SubTOpen}[4]{%
#1%
\vdash^{#2}_{\Aux{open}}%
#3\leq#4%
}
\newcommand*{\TsP}[5]{%
  #1 \bigMid #2\arrowDash\!\!\!\!\!\UpUp{#3}{#4} #5%
  }

%\newcommand\ExtractSigEnv[1]{\sigEnv^{#1}}


\newcommand\IsConstr[2]{\Aux{is-constr}(#1,#2)}
\newcommand\FSet[2]{
\Aux{is-set}(#1,#2)
}
\newcommand\FAccess[2]{
\Aux{is-get}(#1,#2)
}

\newcommand\GarbageOf[1]{\Aux{garbage-of}(#1)}

\newcommand\FRestriction[2]{{
  \left.\kern-\nulldelimiterspace % automatically resize the bar with \right
  #1 % the function
  \vphantom{\big|} % pretend it's a little taller at normal size
  \right|_{#2} % this is the delimiter
  }}

\newcommand\varOpt{\Opt{\varKw}}
\newcommand\xOpt{\Opt{\x}}
\newcommand\TOpt{\Opt{\T}}
\newcommand\ifKw{\Kw{if}}
\newcommand\elseKw{\Kw{else}}
\newcommand\thenKw{\Kw{then}}
\newcommand\whileKw{\Kw{while}}
\newcommand\usingKw{\Kw{using}}
\newcommand\checkKw{\Kw{check}}
\newcommand\andCloseKw{\Kw{andclose}}
%\providecommand\num{}
%\renewcommand\num{\V{\NonTerminale{num}}}
\newcommand\withKw{\Kw{with}}
\newcommand\breakKw{\Terminale{break}}
\newcommand\inKw{\Kw{in}}
\newcommand\traitKw{\Kw{trait}}
\newcommand\match{\V{\cal{G}}}
\newcommand\using{\V{\cal{U}}}
%\newcommand\on{{\cal{O}}}
\newcommand\ps{\V{\NonTerminale{ps}}}
\newcommand\iterDeclaration{\V{\cal{I}}}
\newcommand\is{\Many\iterDeclaration}
\newcommand\With{\V{\cal{W}}}
\newcommand\psv{\V{\NonTerminale{psv}}}
\newcommand\unOp{\V{\NonTerminale{unOp}}}
\newcommand\eqOp{\V{\NonTerminale{eqOp}}}
\newcommand\binOp{\V{\NonTerminale{binOp}}}
\newcommand\boolOp{\V{\NonTerminale{boolOp}}}
\newcommand\bDataOp{\V{\NonTerminale{relOp}}}
\newcommand\dataOp{\V{\NonTerminale{dataOp}}}
\newcommand\stringChar{\V{\NonTerminale{char}}}
\newcommand\xTs{\Many{\NonTerminale{x}\!\!\NonTerminale{T}}}

\newcommand\Desugar[1]{\llbracket #1 \rrbracket}

\newcommand\DesugarWStar[1]{\AddApex{}{\Nv\with*}\!\Desugar{#1}}
\newcommand\DesugarW[1]{\AddApex{}{\Nv\with}\!\Desugar{#1}}
\newcommand\DesugarX[1]{{}^{\Nv\X}\!\Desugar{#1}}
\newcommand\DesugarI[1]{{}^{\Nv\iterDeclaration}\!\Desugar{#1}}
\newcommand\DesugarK[1]{{}^{\Nv{\catch}}\!\Desugar{#1}}
\newcommand\DesugarPs[1]{{}^{\Nv\ps}\!\Desugar{#1}}
\newcommand\DesugarMember[1]{{}^{\Nv\member}\!\Desugar{#1}}

\newcommand\DesugarIteratorOns[2]{\Aux{itOns}(#1)\Desugar{#2}}
\newcommand\DesugarMatch[2]{\Aux{match}(#1)\Desugar{#2}}

\newcommand\DesugarSetOns[2]{\Aux{setOns}(#1)\Desugar{#2}}

\newcommand\ScopeDesugar[1]{%
  %\Aux{scope}
  {}^{\Nv\Path}\!\Desugar{#1}}
\newcommand\Append[1]{\Terminale{'}\!\!\!\Terminale{#1}}
\newcommand\IteratorNext[1]{\Aux{itNext}{(#1)}}

\newcommand\ReplaceAssign[2]{\Aux{replaceAssign}_{#1}{(#2)}}
\newcommand\ZeroOrOneInside[2]{#1\,\Aux{used 0 or 1 times inside}\,#2}
\newcommand\DesugarBaseOns[2]{\Aux{baseOns}(#1)\Desugar{#2}}
\newcommand\GiveName[1]{\Aux{addX}({#1})}


 
\newenvironment{MDefinition}[1]{
%\begin{ensureMathEnv}%
\!\!\!%
\begin{array}{l}%
\textbf{Definition:\,}#1 \\%
\begin{array}{|l}%
}{%
\end{array}%
\end{array}%
%\end{ensureMathEnv}%
}
\newenvironment{sDefinition}{%
\begin{ensureMathEnv}%
\textbf{Definition:\,}%
}{%
\end{ensureMathEnv}%
}

\newenvironment{TitleParagraph}[1]{
\begin{math}%
\!\!\!%
\begin{array}{l}%
\!\!\mbox{\textbf{#1} }\\%
\begin{array}{|l}%
 \begin{minipage}{0.9\linewidth}
}{%
 \end{minipage}
\end{array}%
\end{array}%
\end{math}%
}


\newcommand\methodCtx{\V{\cal{M}\!\Compiled\ctx}}
%\newcommand\f{\V{\cal{F}}}
\newcommand\ft[3]{
  #1\,#3\,#2
%  \ifx #1
%  \else
%    #1\,
%  \fi
%  #2
%  \ifx #3
%  \else
%    \, #3
%  \fi
}
\newcommand\EOL{\scalebox{0.8}[1]{\Terminale{$\NonTerminale{EOL}$}}}
\newcommand\xs{\Many\x}

\newcommand\MatchMh[2]{#1\sim#2}

%-----------------------------------------------------
%-----------------------------------------------------
%----------OP NAMES
%-----------------------------------------------------
%-----------------------------------------------------
\newcommand\aCurrent{\Append{Curr}}
\newcommand\aIterator{\Append{It}}
\newcommand\aTmp{\Append{tmp}}
\newcommand\itNext{\hash\Ident{next}}
\newcommand\itNextVar{\hash\Ident{nextVar}}
\newcommand\itMustEnd{\hash\Ident{checkEnd}}
\newcommand\bCheckTrue{\hash\Ident{checkTrue}}
\newcommand\varFlag{\Terminale{flag}}
\newcommand\varErr{\Terminale{err}}

\newcommand\pStringParser{\hash\Ident{stringParser}}
\newcommand\pNumberParser{\hash\Ident{numberParser}}
\newcommand\pEndParse{\hash\Ident{endParse}}
\newcommand\fApply{\hash\Ident{apply}}
\newcommand\fieldInner{\Ident{inner}}
\newcommand\fieldInnerAux{\Ident{\_inner}}
\newcommand\fieldDelegate{\Ident{delegate}}
\newcommand\itIterator{\hash\Ident{iterator}}
\newcommand\itUpdate{\hash\Ident{update}}
\newcommand\itFinalize{\hash\Ident{close}}
\newcommand\itEmpty{\hash\Ident{empty}}
\newcommand\itAdd{\hash\Ident{add}}
\newcommand\itEnd{\hash\Ident{end}}
\newcommand\itBegin{\hash\Ident{begin}}
\newcommand\itMustNext{\hash\Ident{mustNext}}
\newcommand\thatKw{\Ident{that}}
\newcommand*{\ReduceP}[2]{#1{\ReduceArrow{\!\p;\pt
%;\Many\resource
}#2}}
\newcommand\impl{\NonTerminale{impl}}
\newcommand\nativeKw{\Kw{native}}
%\newcommand\FilterResult[2]{\Aux{filterResult}^{\!#1\!}\!(#2)}
\newcommand\Vars[1]{\Aux{vars}(#1)}
\newcommand\Cast[3]{\Aux{cast}^{#1}(#2\leftarrow#3)}
\newcommand\IfIsVoid[3]{\Aux{if}#1\Aux{ is Void then }#2\Aux{ else }#3}

\newcommand\Next[2]{\Aux{next}_{#1}(#2)}
\newcommand\DeclareIterators[3]{\Aux{declareIts}_{#1}(#2,#3)}
\newcommand\DeclareIterator[2]{\Aux{declareIt}_{#1}(#2)}

\newcommand\FinMany[1]{\Aux{fin}^*(#1)}
\newcommand\FinOne[1]{\Aux{fin}(#1)}
\newcommand\DesugarLoopIteratorOns[2]{\Aux{bodyItOns}(#1)\Desugar{#2}}
\newcommand\DesugarLoopSetOns[2]{\Aux{bodySetOns}(#1)\Desugar{#2}}
\newcommand\DesugarChar[1]{\Desugar{\Terminale'\!\!#1\Terminale'\!\!}}
\newcommand\valP{
  \V{\Val{\p}}
  }
\newcommand\vsP{
  \V{\vs^{\p}}
  }
\renewcommand\ctxVal{
  \V{{\cal{E}}^{\p}}
  }

\ifdefined\block%
  \renewcommand\block{\V{\cal{B}}}
\else%
  \newcommand\block{\V{\cal{B}}}
\fi%


\newcommand\labelMeta{\raisebox{0.2ex}{\scriptsize{\textbf{META}}}}

\newcommand\ImplementationsDefinitions[3]{%
  #1;#2\,%
  \Aux{are impl;decl of }#3%
  }

\newcommand{\vT}{\V{'\!}}
\newcommand{\vi}{\V{i}}
\newcommand{\vj}{\V{j}}
\newcommand{\vn}{\V{n}}
\newcommand{\vk}{\V{k}}
\newcommand{\vz}{\V{0}}
\newcommand{\vI}{\V{1}}
\newcommand{\vII}{\V{2}}
\newcommand{\vIII}{\V{3}}
\newcommand{\vIIII}{\V{4}}




%----------------------
%----------------------
%----------------------
%----------------------LSTLISTING magic stuff
%----------------------
%----------------------
%----------------------

\definecolor{darkRed}{RGB}{100,0,10}
\definecolor{darkBlue}{RGB}{10,0,100}

\lstdefinelanguage{FortyTwo}[]{Java}{morekeywords={%
  exception,error,mut,imm,
  read,capsule,lent,assert
  with,in,immutable,trait,using,
  on,var,loop,reuse,method,is
  },
%  deletekeywords={new,class,this},
 morecomment=[l]',
 texcl=true
 string=[d][\ttfamily]",
 %\texttt{\textbf{\color{darkBlue}
commentstyle=\ttfamily\bfseries\color{darkBlue},
% morestring=[l]',
 stringstyle=\color{red}\ttfamily,
 literate=
                 {\%}{{\mbox{\textbf{\%}}}}1
                 {[}{{\textbf{[}}}1
                 {]}{{\textbf{]}}}1
                 {(}{{\textbf{(}}}1
                 {)}{{\textbf{)}}}1
                 {\{}{{\textbf{\{}}}1
                 {\}}{{\textbf{\}}}}1
                 {;}{{\textbf{;}}}1
                 %{Library}{{\textcolor{black}{\textbf{Library}}}}{1}
                 %{Any}{{\textcolor{black}{\textbf{Any}}}}{1}
                 %{Void}{{\textcolor{black}{\textbf{Void}}}}{1}
                 %{Outer}{{\textcolor{black}{\textbf{Outer}}}}{1}
 }

\lstset{language=FortyTwo,
  basicstyle=\ttfamily\small,
  keywordstyle=\bfseries\color{darkRed},
  showstringspaces=false,
  mathescape=true,
  xleftmargin=0pt,
  xrightmargin=0pt,
  breaklines=false,
  breakatwhitespace=false,
  breakautoindent=false,
%  linewidth=4\textwidth,% should be enough
%  backgroundcolor=\color{grey},
%  frameround=tttt,
%  frame=single,
%  frame=lines,
%  rulecolor=\color{darkGrey},
%  identifierstyle=\relax
  identifierstyle=\idstyle
%  emphstyle=\it,
%  keywordstyle=\ttfamily\bf\small
}
\newcommand{\Comment}[1]{%
  \texttt{\textbf{\color{darkBlue}{//#1}}}%
}
\newcommand{\MComment}[1]{%
  \texttt{\textbf{\color{darkBlue}{/*#1*/}}}%
}
\newcommand{\ReuseUrl}[1]{%
  \scalebox{0.90}[1]{\textit{\color{darkRed}#1}}%
  }

\newcommand{\Q}{\lstinline}


%found on http://tex.stackexchange.com/questions/4198/emphasize-word-beginning-with-uppercase-letters-in-code-with-lstlisting-package
%\lstset{language=FortyTwo,identifierstyle=\idstyle}
%
\makeatletter
\newcommand*\idstyle{%
        \expandafter\id@style\the\lst@token\relax
}
\def\id@style#1#2\relax{%
        \ifcat#1\relax\else
                \ifnum`#1=\uccode`#1%
                        \bfseries
                \fi
        \fi
}
\makeatother


