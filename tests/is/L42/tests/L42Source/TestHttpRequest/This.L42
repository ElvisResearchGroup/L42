reuse [AdamsTowel]

Secret = {...}//THIS FILE IS NOT COMMITTED. You have to fill it with you git access token, as in
//class method S #$of()=S"ghp_..."

//Module 1
HttpRequest = Trait:{...}
HttpRequestDeployed = System.module(
  Class:HttpRequest['HttpRequest$Real=>'HttpRequest.Real],
  n='HttpRequest) //ready for load

//Module 2, depends from Module 1; inlines it internally
GitWriterLib = Trait({...})['GitWriter.HttpRequest.Fail=>'GitWriter.Fail]
GitWriterDeployed = System.module( //ready for load
  Class:GitWriterLib, n='GitWriter)[
    hide='This.#apply(info,pre,center,contentBase64);
    hide='This.getSha(user,repository,path,branch);
    ]

//actually instantiate GW, we need it later
GW = Load:GitWriterDeployed.code()
/*
With the right secret, the code above would test GW, but it is very slow,
so much that it is not worth keeping this test
UseGW = (
  GW.#$of(
    token=Secret.#$of()
    message=S"now from 42 string repr"
    )(
    user=S"example42gdrive"
    repository=S"Example1"
    path=S"bar2/foo.txt"
    contentBase64=S"AbbbbA=="
    )
  )
*/

//Module 3
DeployLib = Trait:{...}
DeployLibDeployed = System.module( //ready for load
  Class:DeployLib, n='LoadDeploy)

//now we can actually deploy on git
LoadDeploy = Load:DeployLibDeployed.code()
DeployGit = LoadDeploy.with(writer=GW)
Writer = {class method mut GW #$of(S that) = 
  GW.#$of(token=Secret.#$of(), message=that++S" automatic release 42V0.95")
  }

//Module 0  -- Towel AdamsTowel --> AdamsTowel
TaskDeployAdams = DeployGit.towel(Trait({reuse [AdamsTowel]})
  on=Url"github.com/Language42/is/AdamsTowel.L42"
  writer=Writer.#$of(S"AdamsTowel")
  )

//Module 1
TaskDeployHttpRequest = DeployGit.towel(HttpRequestDeployed()
  on=Url"github.com/Language42/is/HttpRequest.L42"
  writer=Writer.#$of(S"HttpRequest")
  )
//Module 2
TaskDeployGitWriterDeployed = DeployGit.towel(GitWriterDeployed()
  on=Url"github.com/Language42/is/GitWriter.L42"
  writer=Writer.#$of(S"GitWriter")
  )
//Module 3
TaskDeployDeployLib = DeployGit.towel(DeployLibDeployed()
  on=Url"github.com/Language42/is/Deploy.L42"
  writer=Writer.#$of(S"Deploy")
  )
  
AllDone = {}:Test"All done reached"(Bool.true())