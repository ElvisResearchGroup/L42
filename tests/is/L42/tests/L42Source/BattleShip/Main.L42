Coords = Collection.list(Ships.Coord)
Board = Data:{[HasToS]
  Ships ships
  @Cache.Now class method Void invariant(Ships ships)=(
  totShips=17I//5I+4I+3I+3I+2I
  countNone=Match.Count()(for s in ships \add(s==Ship.None()))
  X[countNone+totShips==100I]
  for s in Ship.Vals() (if s!=Ship.None() (
    coords=Coords()(for si in ships, c in ships.coords(), if si==s \add(c))
    X[coords.size()==s.size()]
    //TODO: check the coords touch each other
    ))
  )
  method FireResult fire(Ships.Coord coord, Shots shots) = FireResult(
    coord = coord,
    shots = shots,
    answer = this.fireAnswer(coord=coord,shots=shots)
    )
  method Answer fireAnswer(Ships.Coord coord, Shots shots) = {
    ship = this.ships().val(coord)
    if ship==Ship.None() return Answer.Miss()
    hits = Match.Count()(
      for s in this.ships().asList(), h in shots.asList() \add(s==ship && h!=S"")
      )
    if hits+1I!=ship.size() return Answer.Hit()
    return ship.answer()
    }
  method toS()=this.ships().toS()
  }
PlayerTrait = Trait:{...}
RandomFireTrait = Trait:{...}

Player1 = Sifo:{}
Player2 = Sifo:{}
Top=Sifo:{[Player1,Player2]}
DeclassifyP1 = {
  class method mut This #$of()
  mut method ResultSigner.Signed (@Player1 ResultSigner.Signed that) = that
  }
DeclassifyP2 = {
  class method mut This #$of()
  mut method ResultSigner.Signed (@Player2 ResultSigner.Signed that) = that
  }
SifoBattleShipAIAI = Sifo(Top):{
  Players=Class:Trait({
    AIPlayer1 = Class.Relax:Data.Relax:PlayerTrait['SelfL=>Player1;'OtherL=>Player2]:RandomFireTrait
    AIPlayer2 = Class.Relax:Data.Relax:PlayerTrait['SelfL=>Player2;'OtherL=>Player1]:RandomFireTrait
    })[
      'AIPlayer1.OtherPlayer=>'AIPlayer2;
      'AIPlayer2.OtherPlayer=>'AIPlayer1;
      'AIPlayer1.Declassify=>DeclassifyP1;
      'AIPlayer2.Declassify=>DeclassifyP2;
      ]
  ExampleGame = {...}
  }
ExampleGame = SifoBattleShipAIAI.ExampleGame.#$of()

//Board={...}
GUIFireTrait = Trait:{...}
SifoBattleShipGUIAI = Sifo(Top):{
  Players=Class:Trait({
    GUIPlayer1 = Class.Relax:Data.Relax:PlayerTrait['SelfL=>Player1;'OtherL=>Player2]:JServer.Handler:GUIFireTrait()
    AIPlayer2 = Class.Relax:Data.Relax:PlayerTrait['SelfL=>Player2;'OtherL=>Player1]:RandomFireTrait
    })[
      'GUIPlayer1.OtherPlayer=>'AIPlayer2;
      'AIPlayer2.OtherPlayer=>'GUIPlayer1;
      'GUIPlayer1.Declassify=>DeclassifyP1;
      'AIPlayer2.Declassify=>DeclassifyP2;
      ]
  ExampleGUIGame = {...}
  }
ExampleGUIGame = SifoBattleShipGUIAI.ExampleGUIGame.#$of()
//first, select a random board and just play.
//Then, also have a phase to ask to approve a random board.
/*Task=(
  //why we do not need the BoxLayout import?
  //model=StartModel.#$of(key='Example)
  j=JServer.#$of()
  gui=Gui(j=j,package=S"battleShip",
    imports=S"""%
      | %Gui.defaultImports()
      | import java.awt.GridLayout;
      | import java.awt.BorderLayout;
      """,
    name='BattleShip,x=800\,y=600\,ping=3000\)
  //b1=gui.button(id=S"reset",msg='Pressed,text=S"PressMe")
  gui"%JavaCode(gui)"
  for e in j(\['BattleShip]) (
    //e>>model.#stage()
    Debug(e)
    )
  )*/